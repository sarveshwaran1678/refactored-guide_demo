name: Python CI/CD Pipeline

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [ '3.8', '3.9', '3.10', '3.11' ]

    steps:
    - uses: actions/checkout@v4
    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
        cache: 'pip'
    
    - name: Install Dependencies
      run: pip install -r requirements.txt
    
    # --- Security Testing Step (Bandit) ---
    - name: Run Static Application Security Test (SAST) with Bandit
      # The command runs bandit recursively on all files,
      # and the --confidence-level and --severity-level ensure 
      # only medium-or-higher confidence/severity issues are reported.
      # If issues are found, this step will fail the build.
      run: bandit -r . --confidence-level MEDIUM --severity-level MEDIUM

    # --- Unit Testing Step ---
    - name: Run Tests and Collect Coverage
      # The --cov=calculator flag specifies what to check coverage on.
      run: pytest --cov=calculator test_calculator.py

    # --- Linting Step (Pylint) ---
    - name: Analyze code with Pylint
      # This command runs Pylint on the main app file.
      run: pylint calculator.py test_calculator.py
      continue-on-error: true # Allows the build to pass even if linting fails